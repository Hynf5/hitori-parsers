name: Discord ¬∑ Commit Notification

on:
  push:
    branches:
      - '**'

jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Get short commit hash
        id: commit
        run: echo "short=${GITHUB_SHA::10}" >> $GITHUB_OUTPUT

      - name: Build commit list
        id: commits
        run: |
           COUNT=$(jq '.commits | length' "$GITHUB_EVENT_PATH")
           echo "count=$COUNT" >> "$GITHUB_OUTPUT"

           echo "list<<EOF" >> "$GITHUB_OUTPUT"
           jq -r '.commits[] |
             "- [\(.id[0:7])](\(.url)) \(.message) - \(.author.username // .author.name)"
           ' "$GITHUB_EVENT_PATH" >> "$GITHUB_OUTPUT"
           echo "EOF" >> "$GITHUB_OUTPUT"

      # ===============================
      # 1Ô∏è‚É£ EMBED INFO COMMIT (HEAD)
      # ===============================
      - name: Send Commit Info (Embed)
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK_URL }}

          embed-title: "üß© New Commit: ${{ github.event.repository.name }}"
          embed-url: https://github.com/${{ github.repository }}/commit/${{ github.sha }}
          embed-thumbnail-url: "${{ secrets.PARSERS_THUMBNAIL_URL }}"
          embed-description: |
            > üìÅ **Repo:** `${{ github.repository }}`
            > üåø **Branch:** `${{ github.ref_name }}`
            > üîñ **Commit:** [`${{ steps.commit.outputs.short }}`](https://github.com/${{ github.repository }}/commit/${{ github.sha }})
          embed-color: 15105570

      # ===============================
      # 2Ô∏è‚É£ EMBED MESSAGE COMMIT 
      # ===============================
      - name: Send Commit Message (Embed)
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK_URL }}

          embed-title: "üìù Commit: ${{ steps.commits.outputs.count }} "
          embed-description: |
            ${{ steps.commits.outputs.list }}
          embed-color: 15105570
          embed-footer-icon-url: "https://github.com/${{ github.actor }}.png"
          embed-footer-text: "${{ github.actor }}"
          embed-timestamp: "${{ github.event.head_commit.timestamp }}"
