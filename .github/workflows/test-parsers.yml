name: Parsers check

on:
  push:
    branches:
      - hitori-pr
    paths:
      - 'src/main/kotlin/org/koitharu/kotatsu/parsers/**'

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository ðŸŒ
        uses: actions/checkout@v5

      - name: Set up Java ðŸ”§
        uses: actions/setup-java@v5
        with:
          java-version: '17'
          distribution: 'temurin'

      - name: Set up Gradle ðŸ“¦
        uses: gradle/actions/setup-gradle@v4

      - name: Compile parsers ðŸš€
        id: build
        run: ./gradlew compileKotlin

      # ===============================
      # âœ… SUCCESS NOTIFICATION
      # ===============================
      - name: Notify Discord (Success) âœ…
        if: success()
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK_URL }}
          embed-title: "âœ… Parsers Build Success"
          embed-description: |
            ðŸ“ Repo: `${{ github.repository }}`
            ðŸŒ¿ Branch: `${{ github.ref_name }}`
          embed-color: 3066993
          embed-url: https://github.com/${{ github.repository }}/commit/${{ github.sha }}
          embed-footer-text: ${{ github.actor }} | ${{ github.sha.substring(0, 10) }}
          embed-footer-icon-url: https://github.com/${{ github.actor }}.png

      # ===============================
      # 2ï¸âƒ£ EMBED MESSAGE COMMIT
      # ===============================
      - name: Send Commit Message (Embed)
        if: success()
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK_URL }}

          embed-title: "ðŸ“ Commit"
          embed-description: |
            
            > ${{ github.event.head_commit.message }}
            
          embed-color: 3066993
          embed-footer-icon-url: "https://github.com/${{ github.actor }}.png"
          embed-footer-text: "${{ github.actor }} | ${{ github.sha.substring(0, 10) }}"
          

      # ===============================
      # âŒ ERROR NOTIFICATION
      # ===============================
      - name: Notify Discord (Failure) â›”
        if: failure()
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK_URL }}
          embed-title: "âŒ Parsers Build Failed"
          embed-description: |
            ðŸš¨ **Error Summary**
            â€¢ Job: `build-and-test`
            â€¢ Step: `Compile parsers`
            
            ðŸ“ Commit:
            > ${{ github.event.head_commit.message }}

            ðŸ”— Logs:
            https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}
          embed-color: 15158332
          embed-footer-text: ${{ github.actor }} | ${{ github.sha.substring(0, 10) }}
          embed-footer-icon-url: https://github.com/${{ github.actor }}.png
